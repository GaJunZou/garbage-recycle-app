<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>æ‰«é›·è¡ŒåŠ¨</title>
    <style>
    </style>
</head>
<style>
    *{
        margin: 0;
        padding:0;
    }
    div{
        float: left;
        width: 270px;
        margin: auto;
        margin-top: 20px;
    }
    ul{
        float: left;
    }
    ul li{
        width: 23px;
        height: 23px;
        list-style: none;
        text-decoration: none;
        background-color: lightgrey;
        border: 2px solid;
        border-color: #ffffff #a1a1a1 #a1a1a1 #ffffff;
        float: left;
        text-align: center;
        line-height: 25px;
        cursor:pointer;
    }
    .wrapper{
        width: 400px;
        text-align: center;
    }
    .demo{
        margin: auto;
    }
    button{
        width: 80px;
        height: 30px;
        font-size: 22px;
        font-weight: 700;
        background-color: lightskyblue;
        border: 2px solid #424242;
    }
    ol li{
    margin: 10px;
    }
    .boom{
        border:3px solid black;
    }
    </style>
    <body>
    <div class="wrapper">
    <button>åˆçº§</button>
    <button>ä¸­çº§</button>
    <button>é«˜çº§</button>
    <br>
    <ol>
        <li>é¼ æ ‡å·¦é”®æ‰“å¼€æ ¼å­</li>
        <li>é¼ æ ‡å³é”®ğŸš©</li>
        <li>æ–¹æ ¼å†…çš„æ•°å­—è¡¨ç¤ºå‘¨å›´å­˜åœ¨çš„ğŸ’£æ•°é‡</li>
        <li>ğŸš©å…¨éƒ¨ğŸ’£ä¸ºæ¸¸æˆèƒœåˆ©</li>
    </ol>
</div>
<div class="demo"></div>
<div class="boom">
</div>
</body>
</html>
<script>
    var ul = document.getElementsByTagName("ul");
    var btn = document.getElementsByTagName("button");
    var div = document.querySelector(".boom");
    var myBoom = document.querySelector(".demo");

    var boomNum = 15;
    var get = 0;
    var boom=[];
    var flag=[];
    var arr=[];

    btn[0].onclick=function(){
        div.remove();
        div=document.createElement("div");
        myBoom.appendChild(div);
        div.setAttribute("class","boom");
        createTable(10,10);
        setBoom(boomNum,10);
        setNumber(10,10);
        open(10);


    }
    btn[1].onclick=function(){
        div.remove();
        div=document.createElement("div");
        myBoom.appendChild(div);
        div.setAttribute("class","boom");
        div.style.width="433px";
        createTable(16,16);
        boomNum=40;
        setBoom(boomNum,16);
        setNumber(16,16);
        open(16);

    }
    btn[2].onclick=function(){
        div.remove();
        div=document.createElement("div");
        myBoom.appendChild(div);
        div.setAttribute("class","boom");
        div.style.width="540px";
        createTable(20,20);
        boomNum=80;
        setBoom(boomNum,20);
        setNumber(20,20);
        open(20);

    }
    document.oncontextmenu = function(e){
        //å–æ¶ˆå³é”®é»˜è®¤äº‹ä»¶
        return false;
    }

    createTable(10,10);
    setBoom(boomNum,10);
    setNumber(10,10);
    open(10);

    function open(size){
        for(var i=0;i<ul.length;i++){
            (function(i){
                ul[i].onmousedown = function(e){
                    var j = [].indexOf.call(this.children,e.target);//è¿™é‡Œè·å–åˆ°äº†å…·ä½“çš„liçš„ç´¢å¼•
                    // this.children ==> åä¸ªli
                    // e.target     ==> å…·ä½“çš„li
                    if (e.button==2){
                        //å³é”®æ’æ——
                        e.preventDefault();
                        e.target.innerText = "ğŸš©";
                        if (arr[i+1][j+1]=="ğŸ’£"){
                            for (var k=0;k<flag.length;k++){
                                if(flag[k][0]==i+1 && flag[k][1]==j+1){
                                    flag.splice(k,1);
                                    get++;
                                    if (get==boomNum){
                                        alert("Victory!");
                                    }
                                }
                            }
                        }
                    }
                    else if(e.button==0){
                        //å·¦é”®
                        if (arr[i+1][j+1]=="ğŸ’£"){
                            //è¸©åˆ°é›·äº†
                            alert("æ¸¸æˆç»“æŸğŸ˜«ğŸ˜­");
                            get=-1000;
                            e.target.innerText = arr[i+1][j+1];
                            e.target.style.backgroundColor="#ff4184";
                            openAllBoom();
                        }
                        else if (arr[i+1][j+1]==0){
                            //æ‰“å¼€æ ¼å­ä¸º0
                            x=i+1;
                            y=j+1;
                            searchZero(x,y,size);
                        }
                        else{
                            //æ‰“å¼€æ ¼å­ä¸ä¸º0
                            e.target.innerText = arr[i+1][j+1];
                        }
                    }
                }
            }(i))
        }
    }

    function searchZero(x,y,size){
        ul[x-1].children[y-1].innerText = "";//arr[x][y]
        var around=[];
        /*
        x-1,y-1     x-1,y   x-1,y+1
        x,y-1       x,y     x,y+1
        x+1,y-1     x+1,y   x+1,y+1
         */
        for(var i=x-1;i<=x+1;i++){
            for(var j=y-1;j<=y+1;j++){
                if( i<1 ||  //ä¸­å¿ƒå¤„äºå·¦è¾¹ç•Œ
                    j<1 ||  //ä¸­å¿ƒå¤„äºä¸Šè¾¹ç•Œ
                    i>=size+1 ||  //ä¸­å¿ƒå¤„äºå³è¾¹ç•Œ
                    j>=size+1 ||  //ä¸­å¿ƒå¤„äºä¸‹è¾¹ç•Œ
                    (i==x && j==y) ||   //å¾ªç¯åˆ°è‡ªå·±
                    arr[x][y] =="ğŸ’£"//å¾ªç¯åˆ°çš„æ˜¯é›·
                ){
                    continue;
                }
                around.push([i,j]);//æ•°æ®åæ ‡
            }
        }
        console.log(around);

        for (var i=0;i<around.length;i++){
            var a=around[i][0];
            var b=around[i][1];
            ul[a-1].children[b-1].className=arr[a][b];
            ul[a-1].children[b-1].style.background="lightgrey";
            ul[a-1].children[b-1].style.border="2px solid lightgrey";
            if(arr[a][b]==0){
                if (ul[a-1].children[b-1].getAttribute("flag")!="flag"){
                    ul[a-1].children[b-1].setAttribute("flag","flag");
                    //éå†è¿‡çš„åšæ ‡è®°
                    searchZero(a,b,size);
                }
            }
            else{
                ul[a-1].children[b-1].innerText=arr[a][b];
            }
        }

    }

    function setBoom(booNum,size){
        //sizeä¸ºç½‘æ ¼å°ºå¯¸
        for (var i = 1;i<=booNum;i++){
            //è®¾ç½®åœ°é›·
            var x = randomNum(size);
            var y = randomNum(size);
            if(arr[x][y]=="ğŸ’£"){
                i--;
            }else{
                arr[x][y] = "ğŸ’£";
                boom[i-1]=[x,y];
            }
        }
        flag = deepCopy(boom,flag);
    }

    function openAllBoom(){
        //ç‚¹å‡»åˆ°ç‚¸å¼¹åæ‰“å¼€å…¨éƒ¨ç‚¸å¼¹
        for (var i=0;i<boom.length;i++){
            ul[boom[i][0]-1].children[boom[i][1]-1].innerText = arr[boom[i][0]][boom[i][1]];
        }
    }

    function setNumber(hen,shu){
        //ä¸ºæ¯ä¸ªæ”¾ä¸ªå¡«ä¸Šæ•°å­—
        for (var i=1;i<=hen;i++){
            //è®¾ç½®å°æ–¹æ ¼æ•°å€¼
            var num=0;
            for(var j=1;j<=shu;j++){
                if(arr[i][j]==0){
                    if (arr[i+1][j]=="ğŸ’£") num++;
                    if (arr[i+1][j+1]=="ğŸ’£") num++;
                    if (arr[i+1][j-1]=="ğŸ’£") num++;
                    if (arr[i-1][j]=="ğŸ’£") num++;
                    if (arr[i-1][j+1]=="ğŸ’£") num++;
                    if (arr[i-1][j-1]=="ğŸ’£") num++;
                    if (arr[i][j+1]=="ğŸ’£") num++;
                    if (arr[i][j-1]=="ğŸ’£") num++;
                    arr[i][j]=num;
                    num=0;
                }

            }
        }
    }

    function deepCopy(origin ,target){//æ·±æ‹·è´
        var target = target || {};//æ²¡æœ‰ä¼ targetæ—¶å°±æŠŠtargetè®¾ä¸ºç©º
        toStr = Object.prototype.toString;//ä½¿ç”¨Objectçš„toStringç”¨äºåˆ¤æ–­å¯¹è±¡è¿˜æ˜¯æ•°ç»„
        arrStr = "[object Array]";//toStringå¦‚æœæ˜¯æ•°ç»„çš„è¿”å›å€¼
        for (var key in origin){
            if(origin.hasOwnProperty(key)){//æ’é™¤åŸå‹é“¾ç»§æ‰¿çš„å±æ€§
                if(origin[key] !== "null" && typeof(origin[key])=="object"){//å¼•ç”¨ç±»å‹çš„å¤„ç†
                    if(toStr.call(origin[key])==arrStr){
                        target[key]=[];//å¦‚æœæ˜¯æ•°ç»„å°±åˆå§‹åŒ–æ•°ç»„ï¼Œè¿›è¡Œé€’å½’
                    }else{
                        target[key]={};//å¦‚æœæ˜¯å¯¹è±¡å°±åˆå§‹åŒ–éƒ½å¯¹è±¡ï¼Œè¿›è¡Œé€’å½’
                    }
                    deepCopy(origin[key],target[key]);//å¼•ç”¨ç±»å‹ä¸èƒ½ç›´æ¥èµ‹å€¼ï¼Œæ‰€ä»¥è¿›è¡Œé€’å½’
                }else{//æ™®é€šç±»å‹çš„å¤„ç†
                    target[key]=origin[key];
                }
            }
        }
        return target;
    }

    function randomNum(x) {
        var num = parseInt(1+Math.random()*(x));
        return num;
    }

    function createTable(hang,lie){
        //hangå’Œlieåˆ›å»ºæ–¹æ ¼
        for (var i=0;i<hang;i++){
            var u=document.createElement("ul");
            for (var j=0;j<lie;j++){
                u.appendChild(document.createElement("li"));
            }
            div.appendChild(u);
        }
        for (var i=0;i<=hang+1;i++){
            arr[i]=[];
            for (var j=0;j<=lie+1;j++){
                arr[i].push(0);
            }
        }
    }
</script>
